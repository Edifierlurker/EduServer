<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE HTML>
<html>
<%
    String  webctx = request.getContextPath();
%>
<head>
    <meta charset="utf-8"/>
    <title>彩票-江苏快3</title>
    <script type="text/javascript"> window.__loadindStartTime = new Date();</script>
    <link rel="stylesheet" href="<%=webctx%>/css/lottery.css"/>
</head>
<body class="" id="notInWebView">
<article class="docBody clearfix newBetPage">
<header id="header">
    <h1>江苏快3</h1>
    <%--<a href="javascript:;" cpurl="/t/award/ssq/?backupUrl=/t/ssq/" class="rightBox" rel="nofollow">往期开奖</a>--%>
    <a class="goBack " href="<%=webctx%>/pages/html/caipiao" target="_self" rel="nofollow">返回</a>
</header>
<section id="wraper">
<div>
<div class="gameBanner hide">
    <span class="period"></span>
    <%--<span class="awardPool">奖池<span class="c_ba142b">4亿7969万</span>，可开出<span class="c_ba142b">95注</span>500万</span>--%>
</div>
<div class="gameTip clearfix">
    <span class="l_box rockTip" style="display:none">摇一摇机选</span>
    <span class="r_box">至少选择6个红球，1个蓝球</span>
</div>
<div class="betBox">
<div class="ballCon redBalls" >
    <ul class="clearfix">
        <li>
            <span class="js-ball" data-value="1">01</span>

        </li>
        <li>
            <span class="js-ball" data-value="2" >02</span>

        </li>
        <li>
            <span class="js-ball" data-value="3">03</span>

        </li>
        <li>
            <span class="js-ball" data-value="4">04</span>

        </li>
        <li>
            <span class="js-ball" data-value="5">05</span>

        </li>
        <li>
            <span class="js-ball" data-value="6">06</span>

        </li>
        <li>
            <span class="js-ball" data-value="7">07</span>

        </li>
        <li>
            <span class="js-ball" data-value="8">08</span>

        </li>
        <li>
            <span class="js-ball" data-value="9">09</span>

        </li>
        <li>
            <span class="js-ball" data-value="10">10</span>

        </li>
        <li>
            <span class="js-ball" data-value="11">11</span>

        </li>
        <li>
            <span class="js-ball" data-value="12">12</span>

        </li>
        <li>
            <span class="js-ball" data-value="13">13</span>

        </li>
        <li>
            <span class="js-ball" data-value="14">14</span>

        </li>
        <li>
            <span class="js-ball" data-value="15">15</span>

        </li>
        <li>
            <span class="js-ball" data-value="16">16</span>

        </li>
        <li>
            <span class="js-ball" data-value="17">17</span>

        </li>
        <li>
            <span class="js-ball" data-value="18">18</span>

        </li>
        <li>
            <span class="js-ball" data-value="19">19</span>

        </li>
        <li>
            <span class="js-ball" data-value="20">20</span>

        </li>
        <li>
            <span class="js-ball" data-value="21">21</span>

        </li>
        <li>
            <span class="js-ball" data-value="22">22</span>

        </li>
        <li>
            <span class="js-ball" data-value="23">23</span>

        </li>
        <li>
            <span class="js-ball" data-value="24">24</span>

        </li>
        <li>
            <span class="js-ball" data-value="25">25</span>

        </li>
        <li>
            <span class="js-ball" data-value="26">26</span>

        </li>
        <li>
            <span class="js-ball" data-value="27">27</span>

        </li>
        <li>
            <span class="js-ball" data-value="28">28</span>

        </li>
        <li>
            <span class="js-ball" data-value="29">29</span>

        </li>
        <li>
            <span class="js-ball" data-value="30">30</span>

        </li>
        <li>
            <span class="js-ball" data-value="31">31</span>

        </li>
        <li>
            <span class="js-ball" data-value="32">32</span>

        </li>
        <li>
            <span class="js-ball" data-value="33">33</span>

        </li>


    </ul>
</div>
<div class="ballCon blueBalls">
    <ul class="clearfix">
        <li>
            <span class="js-ball" data-value="1">01</span>

        </li>
        <li>
            <span class="js-ball" data-value="2">02</span>

        </li>
        <li>
            <span class="js-ball" data-value="3">03</span>

        </li>
        <li>
            <span class="js-ball" data-value="4">04</span>

        </li>
        <li>
            <span class="js-ball" data-value="5">05</span>

        </li>
        <li>
            <span class="js-ball" data-value="6">06</span>

        </li>
        <li>
            <span class="js-ball" data-value="7">07</span>

        </li>
        <li>
            <span class="js-ball" data-value="8">08</span>

        </li>
        <li>
            <span class="js-ball" data-value="9">09</span>

        </li>
        <li>
            <span class="js-ball" data-value="10">10</span>

        </li>
        <li>
            <span class="js-ball" data-value="11">11</span>

        </li>
        <li>
            <span class="js-ball" data-value="12">12</span>

        </li>
        <li>
            <span class="js-ball" data-value="13">13</span>

        </li>
        <li>
            <span class="js-ball" data-value="14">14</span>

        </li>
        <li>
            <span class="js-ball" data-value="15">15</span>

        </li>
        <li>
            <span class="js-ball" data-value="16">16</span>

        </li>
    </ul>
</div>
</div>
</div>
</section>
<section class="betResult">
    <div class="cartLink hide" id="cartLink"><span>查看购彩车<i></i></span></div>
    <em class="bottomBtn clearNum" id="clearNum">清空</em>
    <em class="bottomBtn randomNum" id="randomNum">机选</em>
    <em class="bottomBtn confirm" id="confirm">立即投注</em>
    <em class="bottomBtn cartBtn" id="cartBtn">加入购彩车<i class="orgTip hide">0</i></em>
    <div id="randomTip" class="randomNumTip hide">
        <i><i></i></i>
        <a href="javascript:;" data-count="1"><em class="tips">1</em>1注</a>
        <a href="javascript:;" data-count="5"><em class="tips">5</em>5注</a>
        <a href="javascript:;" data-count="10"><em class="tips">10</em>10注</a>
    </div>
</section>
</article>

<div id="touchStrikeLayout"></div>
<script>window.setTimeout(function(){var l=document.getElementById("touchStrikeLayout");l&&l.parentNode.removeChild(l)},500);</script>
<%
    String ball = request.getParameter("b") == null ? "" : request.getParameter("b");
    int index = request.getParameter("i") == null ? -1 : Integer.parseInt(request.getParameter("i"));
%>
<script src="<%=webctx%>/js/jquery.min.js"></script>
<script src="<%=webctx%>/js/jquery.cookie.js"></script>
<script type="text/javascript">

    var caipiaoArr= new Array();
    var editBalls = '<%=ball%>';
    var currIndex = '<%=index%>';
    function init() {
        var caipiao = $.cookieHelper('balls');
        var count = (caipiao == null ? "0" : caipiao.split("|").length - 1);
        var i = $("#cartBtn").find(".orgTip");
        if (parseInt(count) > 0) {
            $(i).attr("style", "display:inline;");
            if (parseInt(count) <= 9)
                $(i).text(count);
            else
                $(i).text("9+");
            caipiaoArr = caipiao.split("#");
        }
    }

    function editBallInit(){
        var ball = '<%=ball%>';
        if(ball != ''){
            var colors = ball.split("|");
            if(colors.length == 2){
                var red = colors[0].split(",");
                var blue = colors[1].split(",");
                if(red.length >= 6){
                    for(var j=0;j<red.length;j++){
                        $(".redBalls span.js-ball").eq(parseInt(red[j])-1).addClass("got active");
                    }
                    for(var k=0;k<blue.length;k++){
                        $(".blueBalls span.js-ball").eq(parseInt(blue[k])-1).addClass("got active");
                    }
                    $(".betResult").addClass("hasBetNums");
                }
            }
        }
    }

    $(document).ready(function(){
        $(".betResult").addClass("hasNums");
        init();
        editBallInit();

        $.ajax({
            url: "<%=webctx%>/services/caipiao/issue?lottery=001",
            type: "POST",
            cache: false,
            dataType:"json",
            success: function (result) {
                if(result.code != 0 || result.lottery != "001")return;
                var obj = $(".gameBanner").removeClass("hide");
                obj.find(".period").text("第" + result.nextIssue + "期");
            },
            error: function (result) {
                $(".gameBanner").hide();
            }
        });


        $("span.js-ball").bind('click',function(){
            var obj = $(this);
            if(obj.hasClass("active")){
                obj.removeClass("got active");
                if(!$("span.js-ball").hasClass("active")){
                    $(".betResult").removeClass("hasBetNums");
                }
            }else{
                if(!$("span.js-ball").hasClass("active")){
                    $(".betResult").addClass("hasBetNums");
                }
                obj.addClass("got active");
            }
        });

        $("#clearNum").bind('click',function(){
            $("span.js-ball").each(function(i){
                $(this).removeClass("got active");
            });
            $(".betResult").removeClass("hasBetNums");
        });

        $("#randomNum").bind('click',function(){
            $("span.js-ball").each(function(i){
                $(this).removeClass("got active");
            });
            //randomBall();
            $("#randomTip").toggleClass("hide");
        });

        function randomBall(){
            $("span.js-ball").each(function(i){
                $(this).removeClass("got active");
            });
            var redarr = new Array();
            var bluearr = new Array();
            for(var i=0 ;i<33;i++){
                redarr.push(i);
            }
            for(var i=0 ;i<6;i++){
                var t = Math.floor(Math.random() * redarr.length);
                $(".redBalls span.js-ball").eq(redarr.splice(t,1)).addClass("got active");
            }

            for(var i=0 ;i<16;i++){
                bluearr.push(i);
            }
            $(".blueBalls span.js-ball").eq(bluearr.splice(Math.floor(Math.random() * bluearr.length),1)).addClass("got active");
        }

        $("#confirm").bind('click',function(){
            if($(".betResult").hasClass("hasBetNums") && checkValid()) {
                if (editBalls == '') {
                    caipiaoArr.push(getCaipiaoVal());
                } else {
                    caipiaoArr[currIndex] = getCaipiaoVal();
                    editBalls = '';
                    currIndex = '';
                }
                $("span.js-ball").each(function(i){
                    $(this).removeClass("got active");
                });
                gotoPay();
            }else if(!$(".betResult").hasClass("hasBetNums")){
                gotoPay();
            }
        });

        $(".tips").parent().bind('click',function(){
            var obj = this;
            var sz = $(obj).attr("data-count");
            for(var i=0;i<parseInt(sz);i++){
                randomBall();
                caipiaoArr.push(getCaipiaoVal());
                $("span.js-ball").each(function(i){
                    $(this).removeClass("got active");
                });
            }
            gotoPay();
        });

        function getCaipiaoVal(){
            var redStr = new Array();
            $(".redBalls .active").each(function(i){
                var obj =$(this);
                redStr.push(obj.text());
            })
            var blueStr = new Array();
            $(".blueBalls .active").each(function(i){
                var obj =$(this);
                blueStr.push(obj.text());
            })
            return redStr.join() + "|" + blueStr.join();
        }

        function checkValid(){
            var redSize =  $(".redBalls .active").size();
            var blueSize =  $(".blueBalls .active").size();
            if(redSize < 6 || blueSize < 1){
                $("#notInWebView").append('<div class="iDialog iDialogNoTitle iDialogAlert" style="z-index: 1002; width: 22.91rem; margin-left: -275px; margin-top: -77.5px; top: 403px; left: 50%; visibility: visible;" id="iDialog1"><div class="iDialogContent"><div class="iDialogBody"><div class="iDialogMain">请至少选择6个红球,1个蓝球</div></div><div class="iDialogFoot"><a href="#" rel="1" class="iDialogBtn"><span>我知道了</span></a></div></div></div><div style="z-index: 1001;" class="iDialogLayout"></div>');
                $(".iDialogBtn").bind("click",function(){
                    $(this).parents("div.iDialog").remove();
                    $("div.iDialogLayout").remove();
                })
                return false;
            }
            return true;

        }

        $("#cartBtn").bind('click',function(){
            if($(".betResult").hasClass("hasBetNums") && checkValid()) {
                var obj = $(this);
                if(editBalls == '') {
                    var i = $(obj).find(".orgTip");
                    var count = $(i).text();
                    if (count == "0")
                        $(i).attr("style", "display:inline;");
                    if (count != "9+" && parseInt(count) < 9)
                        $(i).text(++count);
                    else
                        $(i).text("9+");
                    caipiaoArr.push(getCaipiaoVal());
                }else{
                    caipiaoArr[currIndex] = getCaipiaoVal();
                    editBalls = '';
                    currIndex = '';
                }
                $("span.js-ball").each(function(i){
                    $(this).removeClass("got active");
                });
                $("#randomTip").removeClass("hide").addClass("hide");
                $("#notInWebView").attr("style","overflow:hidden;");
                $(".betResult").removeClass("hasBetNums");
                $.cookieHelper("balls",caipiaoArr.join("#"),{expires:1,path:'/'});
            }else if(!$(".betResult").hasClass("hasBetNums")){
                randomBall();
                $("#notInWebView").removeAttr("style");
                $(".betResult").addClass("hasBetNums");
            }
        });

        function gotoPay(){
            $.cookieHelper("balls",caipiaoArr.join("#"),{expires:1,path:'/'});
            window.location.href = "<%=webctx%>/pages/html/caipiao/ssq/cart?rt="+Math.random();
        }

    });
</script>
</body>
</html>
